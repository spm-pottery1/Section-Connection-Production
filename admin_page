<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Section Connection | Admin Analytics & Console</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Warm Neutrals & Professional Blues -->
    <!-- Application Structure Plan: 
         The app is designed as a centralized 'Mission Control' dashboard. 
         1. Sidebar Navigation: Persistent access to key views (Overview, User Management, Content Health).
         2. Dashboard Overview: High-level metrics (KPI cards) and trend visualization to give an instant health check.
         3. User Analysis Section: Detailed breakdown of user demographics and status, allowing for direct interaction (filtering/sorting).
         4. Engagement Metrics: Deep dive into conversation types, specifically highlighting the AI Bot usage vs Human connection.
         This structure was chosen to move from 'Macro' (System Health) to 'Micro' (Individual User Management), facilitating the Admin's workflow.
    -->

    <!-- Visualization & Content Choices: 
         1. Report Info: User Growth & Activity -> Goal: Inform/Change -> Method: Line Chart (Chart.js) -> Interaction: Time range filter -> Justification: Shows trends over time clearly.
         2. Report Info: Conversation Distribution -> Goal: Compare -> Method: Doughnut Chart (Chart.js) -> Interaction: Segment clicking -> Justification: Quickly compares 1:1, Group, and AI adoption.
         3. Report Info: User List -> Goal: Organize/Manage -> Method: Interactive HTML Table -> Interaction: Status toggles/Filter -> Justification: Standard, accessible way to manage row-based data.
         4. Report Info: System Status -> Goal: Inform -> Method: CSS/HTML Badge Indicators -> Justification: Instant visual feedback on server health.
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. 
    -->

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; color: #1f2937; }
        
        /* Chart Container Specifics - Strict sizing enforcement */
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px; /* Base height */
            max-height: 400px;
        }
        @media (min-width: 1024px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Animation Classes */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Status Indicators */
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        .dot-green { background-color: #10b981; }
        .dot-red { background-color: #ef4444; }
        .dot-amber { background-color: #f59e0b; }

        .nav-item.active { background-color: #e0e7ff; color: #4338ca; border-right: 4px solid #4338ca; }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-white border-r border-gray-200 flex flex-col justify-between hidden md:flex z-20">
        <div>
            <div class="h-16 flex items-center px-6 border-b border-gray-100">
                <span class="text-xl font-bold text-indigo-700">Section Connection</span>
            </div>
            <nav class="mt-6 px-4 space-y-2">
                <a href="#" class="nav-item active flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-50 transition-colors" onclick="navigate('overview', this)">
                    üìä Dashboard Overview
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-50 transition-colors" onclick="navigate('users', this)">
                    üë• User Management
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-50 transition-colors" onclick="navigate('conversations', this)">
                    üí¨ Engagement Analytics
                </a>
                <a href="#" class="nav-item flex items-center px-4 py-3 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-50 transition-colors" onclick="navigate('audit', this)">
                    üõ°Ô∏è Audit Logs
                </a>
            </nav>
        </div>
        <div class="p-4 border-t border-gray-100">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold">A</div>
                <div>
                    <p class="text-sm font-medium text-gray-900">Admin User</p>
                    <p class="text-xs text-gray-500">Super Admin</p>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto relative" id="main-scroll">
        <!-- Mobile Header -->
        <div class="md:hidden h-16 bg-white border-b flex items-center justify-between px-4 sticky top-0 z-10">
            <span class="text-lg font-bold text-indigo-700">Section Connection</span>
            <button class="text-gray-500" onclick="alert('Menu toggled')">‚ò∞</button>
        </div>

        <div class="p-6 lg:p-10 max-w-7xl mx-auto">
            
            <!-- VIEW: OVERVIEW -->
            <div id="overview" class="view-section fade-in">
                <div class="mb-8">
                    <h1 class="text-2xl font-bold text-gray-900">System Overview</h1>
                    <p class="text-gray-500 mt-1">Real-time pulse of the Section Connection ecosystem.</p>
                </div>

                <!-- KPI Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Total Users -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Total Users</p>
                                <h3 class="text-3xl font-bold text-gray-900 mt-2" id="kpi-users">1,248</h3>
                            </div>
                            <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">+12%</span>
                        </div>
                        <div class="mt-4 h-1 w-full bg-gray-100 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-600 rounded-full" style="width: 75%"></div>
                        </div>
                    </div>

                    <!-- Active Conversations -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Active Chats</p>
                                <h3 class="text-3xl font-bold text-gray-900 mt-2">843</h3>
                            </div>
                            <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full">Live</span>
                        </div>
                        <p class="text-xs text-gray-400 mt-4">Across all channels</p>
                    </div>

                    <!-- AI Bot Interactions -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium text-gray-500">AI Bot Queries</p>
                                <h3 class="text-3xl font-bold text-gray-900 mt-2">15.2k</h3>
                            </div>
                            <span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded-full">+24%</span>
                        </div>
                        <p class="text-xs text-gray-400 mt-4">High engagement detected</p>
                    </div>

                    <!-- System Health -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-sm font-medium text-gray-500">System Health</p>
                                <h3 class="text-lg font-bold text-green-600 mt-2 flex items-center"><span class="status-dot dot-green"></span> Operational</h3>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-5">Uptime: 99.98%</p>
                    </div>
                </div>

                <!-- Main Chart Section -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Line Chart: Message Volume -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 lg:col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-gray-800">Message Traffic Volume</h3>
                            <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-2">
                                <option>Last 7 Days</option>
                                <option>Last 30 Days</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="trafficChart"></canvas>
                        </div>
                    </div>

                    <!-- Doughnut Chart: User Roles -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">User Role Distribution</h3>
                        <div class="chart-container">
                            <canvas id="roleChart"></canvas>
                        </div>
                        <div class="mt-4 flex justify-center gap-4 text-xs text-gray-500">
                            <div class="flex items-center"><span class="w-3 h-3 bg-indigo-500 rounded-full mr-1"></span> User</div>
                            <div class="flex items-center"><span class="w-3 h-3 bg-teal-400 rounded-full mr-1"></span> Admin</div>
                            <div class="flex items-center"><span class="w-3 h-3 bg-purple-500 rounded-full mr-1"></span> AI Bot</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: USERS -->
            <div id="users" class="view-section hidden fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">User Management</h1>
                        <p class="text-gray-500 mt-1">Manage access, roles, and user statuses.</p>
                    </div>
                    <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors" onclick="alert('Feature linked to create_user route')">
                        + Add User
                    </button>
                </div>

                <div class="bg-white shadow-sm border border-gray-200 rounded-xl overflow-hidden">
                    <div class="p-4 border-b border-gray-200 flex flex-col sm:flex-row gap-4 justify-between bg-gray-50">
                        <input type="text" id="userSearch" placeholder="Search by username or email..." class="border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:w-80 p-2.5" onkeyup="filterUsers()">
                        <div class="flex gap-2">
                            <button class="px-3 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">Filter</button>
                            <button class="px-3 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">Export</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b">
                                <tr>
                                    <th scope="col" class="px-6 py-3">User Details</th>
                                    <th scope="col" class="px-6 py-3">Role</th>
                                    <th scope="col" class="px-6 py-3">Status</th>
                                    <th scope="col" class="px-6 py-3">Joined Date</th>
                                    <th scope="col" class="px-6 py-3">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                <!-- JS will populate this -->
                            </tbody>
                        </table>
                    </div>
                    <div class="p-4 border-t border-gray-200 flex justify-between items-center">
                        <span class="text-sm text-gray-500">Showing <span class="font-bold text-gray-900">1-5</span> of <span class="font-bold text-gray-900">12</span></span>
                        <div class="inline-flex -space-x-px text-sm">
                            <button class="px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100">Previous</button>
                            <button class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100">Next</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: CONVERSATIONS -->
            <div id="conversations" class="view-section hidden fade-in">
                <div class="mb-8">
                    <h1 class="text-2xl font-bold text-gray-900">Engagement Analytics</h1>
                    <p class="text-gray-500 mt-1">Deep dive into conversation types and usage.</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Bar Chart: Chat Types -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Conversation Type Distribution</h3>
                        <div class="chart-container">
                            <canvas id="convTypeChart"></canvas>
                        </div>
                        <div class="mt-4 p-4 bg-blue-50 rounded-lg text-sm text-blue-800">
                            <strong>Insight:</strong> AI Bot conversations have overtaken 1:1 chats by 15% this week.
                        </div>
                    </div>

                    <!-- Activity Heatmap Mock -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Peak Activity Hours</h3>
                        <div class="space-y-4">
                            <!-- Simple progress bars to simulate heatmap data -->
                            <div>
                                <div class="flex justify-between text-xs mb-1"><span>09:00 AM</span><span>High</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-indigo-600 h-2.5 rounded-full" style="width: 85%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1"><span>12:00 PM</span><span>Medium</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-indigo-400 h-2.5 rounded-full" style="width: 60%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1"><span>03:00 PM</span><span>High</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-indigo-600 h-2.5 rounded-full" style="width: 90%"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1"><span>08:00 PM</span><span>Low</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-2.5"><div class="bg-indigo-300 h-2.5 rounded-full" style="width: 30%"></div></div>
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-6">Based on UTC timestamps from `messages` table.</p>
                    </div>
                </div>
            </div>

            <!-- VIEW: AUDIT LOGS -->
            <div id="audit" class="view-section hidden fade-in">
                 <div class="mb-8">
                    <h1 class="text-2xl font-bold text-gray-900">System Audit Logs</h1>
                    <p class="text-gray-500 mt-1">Track administrative actions and security events.</p>
                </div>

                <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
                    <table class="w-full text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b">
                            <tr>
                                <th class="px-6 py-3">Timestamp</th>
                                <th class="px-6 py-3">Admin User</th>
                                <th class="px-6 py-3">Action</th>
                                <th class="px-6 py-3">Target</th>
                                <th class="px-6 py-3">Details</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr>
                                <td class="px-6 py-4">2023-10-27 14:23:01</td>
                                <td class="px-6 py-4 font-medium text-gray-900">Pottery (Admin)</td>
                                <td class="px-6 py-4"><span class="bg-red-100 text-red-800 text-xs px-2 py-0.5 rounded">SUSPEND</span></td>
                                <td class="px-6 py-4">User ID: 45</td>
                                <td class="px-6 py-4 text-xs font-mono">Spam activity detected</td>
                            </tr>
                            <tr>
                                <td class="px-6 py-4">2023-10-27 12:10:45</td>
                                <td class="px-6 py-4 font-medium text-gray-900">System Bot</td>
                                <td class="px-6 py-4"><span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-0.5 rounded">FLAG</span></td>
                                <td class="px-6 py-4">Msg ID: 9921</td>
                                <td class="px-6 py-4 text-xs font-mono">Keyword: "phishing"</td>
                            </tr>
                             <tr>
                                <td class="px-6 py-4">2023-10-27 09:00:00</td>
                                <td class="px-6 py-4 font-medium text-gray-900">Pottery (Admin)</td>
                                <td class="px-6 py-4"><span class="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded">CREATE_ROLE</span></td>
                                <td class="px-6 py-4">Role: Moderator</td>
                                <td class="px-6 py-4 text-xs font-mono">Added new role perm</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <!-- JS Logic -->
    <script>
        // --- DATA STORAGE (Mock Data based on Schema) ---
        const usersData = [
            { id: 1, username: "Pottery", email: "spm512hdg@gmail.com", role: "admin", status: "active", joined: "2023-01-15", is_bot: false },
            { id: 2, username: "Alice_W", email: "alice@example.com", role: "user", status: "active", joined: "2023-02-20", is_bot: false },
            { id: 3, username: "Section_AI_Bot", email: "bot@section.ai", role: "user", status: "active", joined: "2023-01-01", is_bot: true },
            { id: 4, username: "Troll_Account", email: "spam@bad.com", role: "user", status: "suspended", joined: "2023-10-25", is_bot: false },
            { id: 5, username: "Moderator_Dave", email: "dave@section.com", role: "moderator", status: "active", joined: "2023-03-12", is_bot: false },
        ];

        // --- NAVIGATION LOGIC ---
        function navigate(viewId, element) {
            // Hide all sections
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            // Show selected section
            document.getElementById(viewId).classList.remove('hidden');
            
            // Update Sidebar Active State
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');

            // Scroll to top
            document.getElementById('main-scroll').scrollTop = 0;
        }

        // --- USER MANAGEMENT LOGIC ---
        function renderUsers(users) {
            const tbody = document.getElementById('userTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = "bg-white border-b hover:bg-gray-50 transition-colors";
                
                // Status Badge Logic
                let statusBadge = user.status === 'active' 
                    ? `<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">Active</span>`
                    : `<span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded">Suspended</span>`;

                // Role Badge Logic
                let roleColor = user.role === 'admin' ? 'bg-purple-100 text-purple-800' : (user.role === 'moderator' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800');
                
                // Bot Badge
                let botBadge = user.is_bot ? `<span class="ml-2 bg-blue-100 text-blue-800 text-[10px] px-1.5 py-0.5 rounded border border-blue-200">BOT</span>` : '';

                row.innerHTML = `
                    <th scope="row" class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600 mr-3">
                                ${user.username.substring(0,2).toUpperCase()}
                            </div>
                            <div>
                                <div class="flex items-center">${user.username} ${botBadge}</div>
                                <div class="text-xs text-gray-500 font-normal">${user.email}</div>
                            </div>
                        </div>
                    </th>
                    <td class="px-6 py-4">
                        <span class="${roleColor} text-xs font-medium px-2.5 py-0.5 rounded capitalize">${user.role}</span>
                    </td>
                    <td class="px-6 py-4">${statusBadge}</td>
                    <td class="px-6 py-4">${user.joined}</td>
                    <td class="px-6 py-4">
                        <button class="font-medium text-indigo-600 hover:underline mr-3" onclick="alert('Editing user ${user.id}')">Edit</button>
                        <button class="font-medium text-red-600 hover:underline" onclick="toggleSuspend(${user.id})">${user.status === 'active' ? 'Suspend' : 'Activate'}</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterUsers() {
            const query = document.getElementById('userSearch').value.toLowerCase();
            const filtered = usersData.filter(u => u.username.toLowerCase().includes(query) || u.email.toLowerCase().includes(query));
            renderUsers(filtered);
        }

        function toggleSuspend(id) {
            const user = usersData.find(u => u.id === id);
            if(user) {
                user.status = user.status === 'active' ? 'suspended' : 'active';
                renderUsers(usersData); // Re-render
            }
        }

        // --- CHART INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderUsers(usersData);

            // Chart 1: Message Traffic (Line)
            const trafficCtx = document.getElementById('trafficChart').getContext('2d');
            new Chart(trafficCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Total Messages',
                        data: [1200, 1900, 1500, 2100, 1800, 900, 1100],
                        borderColor: '#4f46e5', // Indigo-600
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { borderDash: [2, 4] } }, x: { grid: { display: false } } }
                }
            });

            // Chart 2: User Roles (Doughnut)
            const roleCtx = document.getElementById('roleChart').getContext('2d');
            new Chart(roleCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Regular Users', 'Admins', 'Bots/System'],
                    datasets: [{
                        data: [85, 5, 10],
                        backgroundColor: ['#6366f1', '#2dd4bf', '#a855f7'], // Indigo, Teal, Purple
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { display: false } }
                }
            });

            // Chart 3: Conversation Types (Bar)
            const convCtx = document.getElementById('convTypeChart').getContext('2d');
            new Chart(convCtx, {
                type: 'bar',
                data: {
                    labels: ['1-on-1', 'Group Chat', 'AI Bot Chat'],
                    datasets: [{
                        label: 'Active Threads',
                        data: [320, 150, 480],
                        backgroundColor: ['#93c5fd', '#3b82f6', '#4338ca'], // Light Blue to Deep Indigo
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        });
    </script>
</body>
</html>
